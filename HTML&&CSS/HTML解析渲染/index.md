### 主要流程

呈现引擎从网络层获取请求文档的内容，随后开始解析 HTML 文档，并将各标记逐个转化成“内容树”上的 DOM 节点。同时也会解析外部 CSS 文件以及样式元素中的样式数据。HTML 中这些带有视觉指令的样式信息将用于创建另一个树结构：**呈现树**。

呈现树包含多个带有视觉属性（如颜色和尺寸）的矩形。这些矩形的排列顺序就是它们将在屏幕上显示的顺序。

呈现树构建完毕之后，进入“布局”处理阶段，也就是为每个节点分配一个应出现在屏幕上的确切坐标。下一个阶段是“绘制” - 呈现引擎会遍历呈现树，由用户界面后端层将每个节点绘制出来。

需要着重指出的是，这是一个渐进的过程。为达到更好的用户体验，**呈现引擎会力求尽快将内容显示在屏幕上。它不必等到整个 HTML 文档解析完毕之后，就会开始构建呈现树和设置布局**。在不断接收和处理来自网络的其余内容的同时，呈现引擎会将部分内容解析并显示出来。

解析渲染该过程主要分为以下步骤：

1. 解析 HTML
2. 构建 DOM 树
3. DOM 树与 CSS 样式进行附着构造呈现树
4. 布局
5. 绘制

### 解析与构建 DOM 树

前两步我们放在一起讨论，浏览器的实际工作也是将他们放在一起进行的。浏览器中的呈现引擎用来解析 HTML 以及 CSS。JavaScript 引擎用来解析和执行 JavaScript。
在构建 DOM 树的过程中，会遇到 CSS 样式表，link 标签，脚本文件等元素，导致阻塞。具体分析可以看[CSS 和 JS 的解析和阻塞]()。

### 构建呈现树

什么是呈现树？它由可视化元素按照其显示顺序而组成的树，也是文档的可视化表示。它的作用是让您按照正确的顺序绘制内容。
这里涉及到一个 CSS 的权重和优先级的问题，可以看下[CSS 的权重与优先级](https://github.com/kkkdb/note/blob/master/HTML%26%26CSS/CSS%E5%92%8CJS%E7%9A%84%E8%A7%A3%E6%9E%90%E5%92%8C%E9%98%BB%E5%A1%9E/index.md)。

### 布局

构建完呈现树之后，呈现器便开始计算每个呈现树节点的大小和位置信息，这被称之为布局或者重排。
布局过程是递归进行的，从根呈现器（也就是浏览器的 html 节点）开始，然后递归遍历子节点，为每一需要计算的呈现器计算几何信息。
每个呈现器有一个"layout"或者"reflow"的方法，父代会调用子代的 layout 方法

### 绘制

在绘制阶段，系统会遍历呈现树，然后调用呈现器的"paint"方法，将呈现器的内容绘制在界面上。

### 个人总结

总结一下，呈现引擎从网络层获取请求文档的内容，然后开始解析 HTML 的文档，并逐个转换成 DOM 树上 DOM 节点。同时也会去解析外部的 CSS 文件和样式元素中的样式数据。HTML 中这些带有视觉指令的信息将会创建另一个树结构：呈现树。呈现树构建完成后，呈现引擎将对呈现树进行布局和绘制。

参考文献： [HTML 渲染过程详解](https://www.cnblogs.com/dojo-lzz/p/3983335.html)、[浏览器解析渲染HTML文档的过程](https://segmentfault.com/a/1190000018652029)
