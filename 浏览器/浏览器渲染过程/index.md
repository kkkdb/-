### 浏览器解析流程

![浏览器解析流程](http://udh.oss-cn-hangzhou.aliyuncs.com/223d421d-bb71-4c10-947d-0e5787d85173161916811175740888521305afbe6c95934bfix732.png)

一般来讲，我们认为浏览器从网络层接收到 HTML 文档内容，然后开始解析文档生成 DOM 树，遇到 CSS 样式表标签或 JS 脚本标签就起新线程去下载它们，并继续构建 DOM 树，浏览器根据 DOM 树构建渲染树，最后浏览器将渲染书绘制到用户界面。

在上述描述中，需要着重指出的是，HTML 文档的解析和渲染是一个渐进的过程。为达到更好的用户体验，呈现引擎会力求尽快将内容显示在屏幕上。它不必等到整个 HTML 文档解析完毕，就会开始构建呈现树和设置布局。在不断接收和处理来自网络的其余内容的同时，呈现引擎会将部分内容解析并显示出来。

浏览器的**预解析**。WebKit 和 Firefox 都进行了这项优化。**在执行脚本时，其他线程会解析 HTML 文档的其余部分，找出并加载需要通过网络加载的其他资源。通过这种方式，资源可以在并行连接上加载，从而提高总体速度**。请注意，预解析器不会修改 DOM 树，而是将这项工作交由主解析器处理；预解析器只会解析外部资源（例如外部脚本、样式表和图片）的引用。

浏览器的预解析可以减缓渲染被阻塞的情况，例如文档解析过程中预加载器发现了 <script src="last.js"></script> 标签，会对 last.js 文件进行加载并放在浏览器缓存中，这样当解析器遇到这个 <script> 标记时，由于预加载器已经将 last.js 文件加载下来了，所以 last.js 会被立即执行，不需要等待从网络抓取资源，减缓了对渲染的阻塞。
